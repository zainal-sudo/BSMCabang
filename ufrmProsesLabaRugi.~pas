unit ufrmtutupperiode;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, Grids,  AdvGrid, ComCtrls, StdCtrls, AdvEdit, ExtCtrls,
  AdvPanel, AdvCGrid, BaseGrid,SqlExpr, DBAdvGrd, DB, DBClient, Provider,
  FMTBcd, RAWPrinter, StrUtils, cxGraphics, cxControls, cxLookAndFeels,
  cxLookAndFeelPainters, cxContainer, cxEdit, dxSkinsCore,
  dxSkinsDefaultPainters, cxTextEdit, cxMaskEdit, cxDropDownEdit,
  cxLookupEdit, cxDBLookupEdit, cxDBExtLookupComboBox, cxStyles,
  dxSkinscxPCPainter, cxCustomData, cxFilter, cxData, cxDataStorage,
  cxDBData, cxSpinEdit, cxCalendar, Menus, cxButtons, cxGridLevel,
  cxGridCustomTableView, cxGridTableView, cxGridDBTableView, cxClasses,
  cxGridCustomView, cxGrid, cxButtonEdit, cxCurrencyEdit,ExcelXP,ComObj,
  AdvCombo,DateUtils, cxPC;

type
  TfrmTutupPeriode = class(TForm)
    AdvPanel1: TAdvPanel;
    lbljudul: TLabel;
    AdvPanel2: TAdvPanel;
    Label3: TLabel;
    Label5: TLabel;
    RAWPrinter1: TRAWPrinter;
    AdvPanel4: TAdvPanel;
    cxButton8: TcxButton;
    cxButton2: TcxButton;
    cxButton1: TcxButton;
    PopupMenu1: TPopupMenu;
    HapusRecord1: TMenuItem;
    Button1: TButton;
    OpenDialog1: TOpenDialog;
    cbbBulan: TAdvComboBox;
    edtTahun: TComboBox;
    Button2: TButton;
    cxStyleRepository2: TcxStyleRepository;
    cxStyle2: TcxStyle;
    MainMenu1: TMainMenu;
    procedure Button1Click(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure FormKeyPress(Sender: TObject; var Key: Char);
    procedure cxButton8Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
    private
      { Private declarations }
     protected
  public
    { Public declarations }
  end;

var
  frmTutupPeriode: TfrmTutupPeriode;

implementation

uses MAIN,uModuleConnection,uFrmbantuan,Ulib,uReport;

{$R *.dfm}

procedure TfrmTutupPeriode.Button1Click(Sender: TObject);
var
 anomor , s,ss:string;
 tsql:TSQLQuery;
begin

end;

procedure TfrmTutupPeriode.FormClose(Sender: TObject;
  var Action: TCloseAction);
begin
  Action := caFree;
  Release;
end;

procedure TfrmTutupPeriode.FormKeyPress(Sender: TObject; var Key: Char);
begin
  if Key = #13 then
     SelectNext(ActiveControl,True,True);
end;



procedure TfrmTutupPeriode.cxButton8Click(Sender: TObject);
begin
Release;
end;

procedure TfrmTutupPeriode.Button2Click(Sender: TObject);
var
  s:string;
  tsql :TSQLQuery;
begin
  s := ' select lr_kode ,lr_nama ,lr_nilai,lr_cabang  from tlabarugi '
     + ' inner join tkomponenlabarugi on lr_kode=klr_kode '
     + ' where '
     + ' lr_periode = ' + IntToStr(cbbBulan.ItemIndex+1)
     + ' and lr_tahun = ' + edtTahun.Text
     + ' order by klr_idkelompok,lr_kode '
     + ';';
    tsql := xOpenQuery(s,frmMenu.conn) ;
   try
       with  tsql do
       begin
         CDS.EmptyDataSet;
         while  not Eof do
         begin
                CDS.Append;
                CDS.FieldByName('kode').AsString := Fieldbyname('lr_kode').AsString;
                CDS.FieldByName('Nama').AsString := Fieldbyname('lr_nama').AsString;
                CDS.FieldByName('nilai').asfloat  := Fieldbyname('lr_nilai').asfloat;
                CDS.FieldByName('cabang').AsString := Fieldbyname('lr_cabang').AsString;
                CDS.Post;
                next;
         end ;
      end;
   finally
     tsql.Free;
   end;
      labarugi;

   s := ' select rek_nama nama,sum(jurd_debet) nilai from tjurnal inner join tjurnalitem on '
      + ' jur_no=jurd_jur_no '
      + ' inner join trekening on rek_kode=jurd_rek_kode '
      + ' where rek_kol_id in (12,13) and month(jur_tanggal)= '+ IntToStr(cbbBulan.ItemIndex+1)
      + ' and year(jur_tanggal)='+ edtTahun.Text
      + ' group by rek_nama' ;

   tsql := xOpenQuery(s,frmMenu.conn) ;
   try
       with  tsql do
       begin
         CDS1.EmptyDataSet;
         while  not Eof do
         begin
                CDS1.Append;
                CDS1.FieldByName('Nama').AsString := Fieldbyname('nama').AsString;
                CDS1.FieldByName('nilai').asfloat  := Fieldbyname('nilai').asfloat;
                CDS1.Post;
                next;
         end ;
      end;
   finally
     tsql.Free;
   end;
end;








end.
